import { bytesToBigInt, toBytes } from "viem";
import Decimal from "decimal.js";
import { zeroExtendBufToGivenSize } from "./utils";
export var CurrencyID;
(function (CurrencyID) {
    CurrencyID[CurrencyID["USDC"] = 1] = "USDC";
    CurrencyID[CurrencyID["USDT"] = 2] = "USDT";
    CurrencyID[CurrencyID["ETH"] = 3] = "ETH";
    CurrencyID[CurrencyID["POL"] = 4] = "POL";
    CurrencyID[CurrencyID["AVAX"] = 5] = "AVAX";
    CurrencyID[CurrencyID["HYPE"] = 16] = "HYPE";
    CurrencyID[CurrencyID["KAIA"] = 17] = "KAIA";
})(CurrencyID || (CurrencyID = {}));
export class Currency {
    currencyID;
    decimals;
    permitVariant;
    permitContractVersion;
    isGasToken;
    // this is always 32 byte long
    tokenAddress;
    /* This is the ratio between one unit to the smallest unit used.
  
       For example, USDC, which has a ‘decimals’ value of 6, is designed so that 1 USDC = 10⁶ μUSDC, which is the smallest indivisible amount representable.
     */
    oneUnitToAtomicUnitRatio;
    constructor(currencyID, tokenAddress, decimals, permitVariant, permitContractVersion = 0, isGasToken) {
        this.currencyID = currencyID;
        this.decimals = decimals;
        this.permitVariant = permitVariant;
        this.permitContractVersion = permitContractVersion;
        this.isGasToken = isGasToken;
        if (typeof tokenAddress === 'string') {
            this.tokenAddress = zeroExtendBufToGivenSize(toBytes(tokenAddress), 32);
        }
        else if (tokenAddress instanceof Uint8Array) {
            this.tokenAddress = zeroExtendBufToGivenSize(tokenAddress, 32);
        }
        else if (Array.isArray(tokenAddress) && tokenAddress.length >= 1 && typeof tokenAddress[0] === 'number') {
            this.tokenAddress = zeroExtendBufToGivenSize(Buffer.from(tokenAddress), 32);
        }
        this.oneUnitToAtomicUnitRatio = Decimal.pow(10, decimals);
    }
    convertUnitsToAmountDecimal(input) {
        let rawunits;
        if (typeof input === 'bigint') {
            rawunits = input.toString(10);
        }
        else if (typeof input === 'number') {
            rawunits = input.toString();
        }
        else if (input instanceof Uint8Array) {
            rawunits = bytesToBigInt(input).toString(10);
        }
        else if (typeof input === 'string') {
            rawunits = input;
        }
        else {
            throw new Error('Invalid input');
        }
        return Decimal.div(rawunits, this.oneUnitToAtomicUnitRatio);
    }
    convertAmountToUnitsInBinary(input) {
        return Buffer.from(toBytes(input.mul(this.oneUnitToAtomicUnitRatio).ceil().toHex()));
    }
}
